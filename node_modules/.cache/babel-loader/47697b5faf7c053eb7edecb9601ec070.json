{"ast":null,"code":"\"use strict\";\n\nvar __rest = this && this.__rest || function (s, e) {\n  var t = {};\n\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\n\nvar __read = this && this.__read || function (o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n      r,\n      ar = [],\n      e;\n\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n\n  return ar;\n};\n\nvar __spreadArray = this && this.__spreadArray || function (to, from) {\n  for (var i = 0, il = from.length, j = to.length; i < il; i++, j++) to[j] = from[i];\n\n  return to;\n};\n\nexports.__esModule = true;\nexports.sync = void 0;\n\nvar glossary_1 = require(\"../glossary\");\n\nvar Database_1 = require(\"../db/Database\");\n\nvar inheritInternalProperties_1 = require(\"../utils/inheritInternalProperties\");\n\nfunction removeListeners(event, db) {\n  var listeners = db.events.listeners(event);\n  listeners.forEach(function (listener) {\n    db.events.removeListener(event, listener);\n  });\n  return function () {\n    listeners.forEach(function (listener) {\n      db.events.addListener(event, listener);\n    });\n  };\n}\n/**\n * Sets the serialized internal properties as symbols\n * on the given entity.\n * @note `Symbol` properties are stripped off when sending\n * an object over an event emitter.\n */\n\n\nfunction deserializeEntity(entity) {\n  var _a;\n\n  var _b = entity,\n      _c = Database_1.SERIALIZED_INTERNAL_PROPERTIES_KEY,\n      internalProperties = _b[_c],\n      publicProperties = __rest(_b, [typeof _c === \"symbol\" ? _c : _c + \"\"]);\n\n  inheritInternalProperties_1.inheritInternalProperties(publicProperties, (_a = {}, _a[glossary_1.ENTITY_TYPE] = internalProperties.entityType, _a[glossary_1.PRIMARY_KEY] = internalProperties.primaryKey, _a));\n  return publicProperties;\n}\n/**\n * Synchronizes database operations across multiple clients.\n */\n\n\nfunction sync(db) {\n  var IS_BROWSER = typeof window !== 'undefined';\n  var SUPPORTS_BROADCAST_CHANNEL = typeof BroadcastChannel !== 'undefined';\n\n  if (!IS_BROWSER || !SUPPORTS_BROADCAST_CHANNEL) {\n    return;\n  }\n\n  var channel = new BroadcastChannel('mswjs/data/sync');\n  channel.addEventListener('message', function (event) {\n    var _a = __read(event.data.payload, 1),\n        sourceId = _a[0]; // Ignore messages originating from unrelated databases.\n    // Useful in case of multiple databases on the same page.\n\n\n    if (db.id !== sourceId) {\n      return;\n    } // Remove database event listener for the signaled operation\n    // to prevent an infinite loop when applying this operation.\n\n\n    var restoreListeners = removeListeners(event.data.operationType, db); // Apply the database operation signaled from another client\n    // to the current database instance.\n\n    switch (event.data.operationType) {\n      case 'create':\n        {\n          var _b = __read(event.data.payload[1], 3),\n              modelName = _b[0],\n              entity = _b[1],\n              customPrimaryKey = _b[2];\n\n          db.create(modelName, deserializeEntity(entity), customPrimaryKey);\n          break;\n        }\n\n      case 'update':\n        {\n          var _c = __read(event.data.payload[1], 3),\n              modelName = _c[0],\n              prevEntity = _c[1],\n              nextEntity = _c[2];\n\n          db.update(modelName, deserializeEntity(prevEntity), deserializeEntity(nextEntity));\n          break;\n        }\n\n      default:\n        {\n          db[event.data.operationType].apply(db, __spreadArray([], __read(event.data.payload[1])));\n        }\n    } // Re-attach database event listeners.\n\n\n    restoreListeners();\n  }); // Broadcast the emitted event from this client\n  // to all the other connected clients.\n\n  function broadcastDatabaseEvent(operationType) {\n    return function () {\n      var payload = [];\n\n      for (var _i = 0; _i < arguments.length; _i++) {\n        payload[_i] = arguments[_i];\n      }\n\n      channel.postMessage({\n        operationType: operationType,\n        payload: payload\n      });\n    };\n  }\n\n  db.events.on('create', broadcastDatabaseEvent('create'));\n  db.events.on('update', broadcastDatabaseEvent('update'));\n  db.events.on('delete', broadcastDatabaseEvent('delete'));\n}\n\nexports.sync = sync;","map":{"version":3,"sources":["C:/Users/Administrator/Desktop/Nodric/finnal/node_modules/@mswjs/data/lib/extensions/sync.js"],"names":["__rest","s","e","t","p","Object","prototype","hasOwnProperty","call","indexOf","getOwnPropertySymbols","i","length","propertyIsEnumerable","__read","o","n","m","Symbol","iterator","r","ar","next","done","push","value","error","__spreadArray","to","from","il","j","exports","__esModule","sync","glossary_1","require","Database_1","inheritInternalProperties_1","removeListeners","event","db","listeners","events","forEach","listener","removeListener","addListener","deserializeEntity","entity","_a","_b","_c","SERIALIZED_INTERNAL_PROPERTIES_KEY","internalProperties","publicProperties","inheritInternalProperties","ENTITY_TYPE","entityType","PRIMARY_KEY","primaryKey","IS_BROWSER","window","SUPPORTS_BROADCAST_CHANNEL","BroadcastChannel","channel","addEventListener","data","payload","sourceId","id","restoreListeners","operationType","modelName","customPrimaryKey","create","prevEntity","nextEntity","update","apply","broadcastDatabaseEvent","_i","arguments","postMessage","on"],"mappings":"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","sourcesContent":["\"use strict\";\nvar __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n                t[p[i]] = s[p[i]];\n        }\n    return t;\n};\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from) {\n    for (var i = 0, il = from.length, j = to.length; i < il; i++, j++)\n        to[j] = from[i];\n    return to;\n};\nexports.__esModule = true;\nexports.sync = void 0;\nvar glossary_1 = require(\"../glossary\");\nvar Database_1 = require(\"../db/Database\");\nvar inheritInternalProperties_1 = require(\"../utils/inheritInternalProperties\");\nfunction removeListeners(event, db) {\n    var listeners = db.events.listeners(event);\n    listeners.forEach(function (listener) {\n        db.events.removeListener(event, listener);\n    });\n    return function () {\n        listeners.forEach(function (listener) {\n            db.events.addListener(event, listener);\n        });\n    };\n}\n/**\n * Sets the serialized internal properties as symbols\n * on the given entity.\n * @note `Symbol` properties are stripped off when sending\n * an object over an event emitter.\n */\nfunction deserializeEntity(entity) {\n    var _a;\n    var _b = entity, _c = Database_1.SERIALIZED_INTERNAL_PROPERTIES_KEY, internalProperties = _b[_c], publicProperties = __rest(_b, [typeof _c === \"symbol\" ? _c : _c + \"\"]);\n    inheritInternalProperties_1.inheritInternalProperties(publicProperties, (_a = {},\n        _a[glossary_1.ENTITY_TYPE] = internalProperties.entityType,\n        _a[glossary_1.PRIMARY_KEY] = internalProperties.primaryKey,\n        _a));\n    return publicProperties;\n}\n/**\n * Synchronizes database operations across multiple clients.\n */\nfunction sync(db) {\n    var IS_BROWSER = typeof window !== 'undefined';\n    var SUPPORTS_BROADCAST_CHANNEL = typeof BroadcastChannel !== 'undefined';\n    if (!IS_BROWSER || !SUPPORTS_BROADCAST_CHANNEL) {\n        return;\n    }\n    var channel = new BroadcastChannel('mswjs/data/sync');\n    channel.addEventListener('message', function (event) {\n        var _a = __read(event.data.payload, 1), sourceId = _a[0];\n        // Ignore messages originating from unrelated databases.\n        // Useful in case of multiple databases on the same page.\n        if (db.id !== sourceId) {\n            return;\n        }\n        // Remove database event listener for the signaled operation\n        // to prevent an infinite loop when applying this operation.\n        var restoreListeners = removeListeners(event.data.operationType, db);\n        // Apply the database operation signaled from another client\n        // to the current database instance.\n        switch (event.data.operationType) {\n            case 'create': {\n                var _b = __read(event.data.payload[1], 3), modelName = _b[0], entity = _b[1], customPrimaryKey = _b[2];\n                db.create(modelName, deserializeEntity(entity), customPrimaryKey);\n                break;\n            }\n            case 'update': {\n                var _c = __read(event.data.payload[1], 3), modelName = _c[0], prevEntity = _c[1], nextEntity = _c[2];\n                db.update(modelName, deserializeEntity(prevEntity), deserializeEntity(nextEntity));\n                break;\n            }\n            default: {\n                db[event.data.operationType].apply(db, __spreadArray([], __read(event.data.payload[1])));\n            }\n        }\n        // Re-attach database event listeners.\n        restoreListeners();\n    });\n    // Broadcast the emitted event from this client\n    // to all the other connected clients.\n    function broadcastDatabaseEvent(operationType) {\n        return function () {\n            var payload = [];\n            for (var _i = 0; _i < arguments.length; _i++) {\n                payload[_i] = arguments[_i];\n            }\n            channel.postMessage({\n                operationType: operationType,\n                payload: payload\n            });\n        };\n    }\n    db.events.on('create', broadcastDatabaseEvent('create'));\n    db.events.on('update', broadcastDatabaseEvent('update'));\n    db.events.on('delete', broadcastDatabaseEvent('delete'));\n}\nexports.sync = sync;\n"]},"metadata":{},"sourceType":"script"}